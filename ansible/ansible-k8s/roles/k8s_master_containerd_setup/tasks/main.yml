---
- name: Start Kubelet service
  service:
    name: kubelet
    state: started
    enabled: yes

- name: Generate kube-konfig.yaml
  template:
    src: kube-config.j2
    dest: $HOME/kube-config.yaml
    mode: 0644

- name: Create hidden directory
  file:
    path: $HOME/.ansible_k8s
    state: directory
    owner: root
    group: root
    mode: 0755

# tasks file for k8s_master_setup on the 1st node
# --upload-certs
- name: initialize the cluster
  shell: kubeadm init  --config kube-config.yaml >> .ansible_k8s/cluster_initialized.txt
  args:
   chdir: $HOME
   creates: .ansible_k8s/cluster_initialized.txt

- name: create .kube directory
  file:
    path: $HOME/.kube
    state: directory
    mode: 0755

- name: copy admin.conf to user kube config
  copy:
    src: /etc/kubernetes/admin.conf
    dest: /root/.kube/config
    remote_src: yes
    owner: root
